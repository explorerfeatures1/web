#!/usr/bin/env python3
"""
Сканер уязвимых NTP серверов для CTF
"""

import socket
import sys

def check_ntp_vulnerability(host, port=123):
    """Проверка, отвечает ли NTP сервер на поддельные запросы"""
    try:
        # Создаем raw socket для подделки пакетов
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.settimeout(3)
        
        # Простой NTP запрос (режим 3, версия 4)
        ntp_request = b'\x23' + b'\x00' * 47
        
        # Отправляем на NTP порт
        s.sendto(ntp_request, (host, port))
        
        try:
            data, addr = s.recvfrom(1024)
            print(f"[+] {host}:{port} - NTP сервер отвечает")
            print(f"    Получено {len(data)} байт от {addr}")
            return True
        except socket.timeout:
            print(f"[-] {host}:{port} - Нет ответа (возможно фильтрация)")
            return False
            
    except Exception as e:
        print(f"[-] Ошибка проверки {host}: {e}")
        return False

# Для CTF задания
if __name__ == "__main__":
    targets = ["ip1", "ip2"]
    
    for target in targets:
        print(f"\n[*] Проверка {target}...")
        if check_ntp_vulnerability(target):
            print(f"[!] {target} потенциально уязвим к CVE-2019-11331")
